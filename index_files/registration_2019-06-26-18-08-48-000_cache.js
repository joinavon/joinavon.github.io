function checkEmail(val){if(!angular.isUndefined(val)){var filter=/^[_a-zA-Z0-9\-]+(\.[_a-zA-Z0-9\-]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})$/;if(filter.test(val))return true;else return false}else return false}var device;var isMobile;
function resolution(){if(Modernizr.mq("all and (max-width: 640px)")){device="mobile";isMobile=true}else if(Modernizr.mq("all and (max-width: 1024px) and (min-width: 641px)")){device="tablet";isMobile=true}else if(Modernizr.mq("all and (min-width: 1025px)")){device="desktop";isMobile=false}}resolution();window.onload=function(){setTimeout(function(){if(!checkEmail($("#email").val()))$("#email").val("");$("#password").val("")},500)};
app.controller("registrationController",["$scope","$resource","$cookies","$rootScope","$http","$sessionStorage","$window","$location","$filter","$sce",function($scope,$resource,$cookies,$rootScope,$http,$sessionStorage,$window,$location,$filter,$sce){var registrationWSConfigData=JSON.parse(registrationWSData);getContent();function getContent(){$scope.header=registrationContentDataJSON.header;$scope.yourMentor=registrationContentDataJSON.yourMentor;$scope.removeLabel=registrationContentDataJSON.removeLabel;
$scope.firstNameLabel=registrationContentDataJSON.firstName;$scope.lastNameLabel=registrationContentDataJSON.lastName;$scope.emailAddress=registrationContentDataJSON.emailAddress;$scope.passwordLabel=registrationContentDataJSON.passwordLabel;$scope.register=registrationContentDataJSON.register;$scope.haveAnAcct=registrationContentDataJSON.haveAnAcct;$scope.signInLabel=registrationContentDataJSON.signInLabel;$scope.cdnLinkForE=registrationContentDataJSON.cdnLinkForE;$scope.pswdStrength=registrationContentDataJSON.pswdStrength;
$scope.weakLabel=registrationContentDataJSON.weakLabel;$scope.strongLabel=registrationContentDataJSON.strongLabel;$scope.noOfChars=registrationContentDataJSON.noOfChars;$scope.oneSymbolOrNum=registrationContentDataJSON.oneSymbolOrNum;$scope.oneNumber=registrationContentDataJSON.oneNumber;$scope.oneLetter=registrationContentDataJSON.oneLetter;if(registrationContentDataJSON.reqFieldDetails=="htmlText")$scope.reqFieldDetails=registrationContentDataJSON.htmlText;else $scope.reqFieldDetails=registrationContentDataJSON.richText;
$scope.crossImg=crossImg;$scope.checkMarkImg=checkMarkImg;$scope.profileImg=profileImg;$scope.signInLink=configData.signInPage;$scope.emailPatternError=errorContentDataJSON.emailPatternError;$scope.frstNmReqError=errorContentDataJSON.frstNmReqError;$scope.lstNmReqError=errorContentDataJSON.lstNmReqError;$scope.frstNmPatternError=errorContentDataJSON.frstNmPatternError;$scope.lstNmPatternError=errorContentDataJSON.lstNmPatternError;$scope.emailReqError=errorContentDataJSON.emailReqError;$scope.pswdReqError=
errorContentDataJSON.pswdReqError;$scope.pswdComplexitySpecialCharactersError=errorContentDataJSON.pswdComplexitySpecialCharactersError}function getParameterByName(name){var match=RegExp("[?\x26]"+name+"\x3d([^\x26]*)").exec(window.location.search);return match&&decodeURIComponent(match[1].replace(/\+/g," "))}$scope.shopUrl=false;$scope.mentorActNo="";$scope.refCode="";if(getParameterByName("shopURL")!=null){$scope.shopUrl=true;$scope.refCode=getParameterByName("shopURL")}var marketingType=getParameterByName("p");
var mrktnChnlTyp=getParameterByName("c");var mrktnSource=getParameterByName("s");$scope.customerCareId=getParameterByName("agentId");var expParam=getParameterByName("exp");var mrktnOtc=getParameterByName("otc");$scope.siteid=getParameterByName("siteid");$scope.isCustCare=false;if($scope.siteid!=undefined&&$scope.siteid!=null&&$scope.siteid.trim().toLowerCase()=="sellavoncc")$scope.isCustCare=true;$scope.showRefDiv=false;$scope.firstNameValid=false;$scope.lastNameValid=false;$scope.emailValid=false;
$scope.validatePasswordComplexity=false;var letter=/[a-zA-Z]/;var number=/[0-9]/;var specialChar=/[@!#\$\^&*()+=\-\[\]\\;,\.\/\{\}\|:<>\?]/;var lengthFlag=false;var symbolFlag=false;var letterFlag=false;var numberFlag=false;var specialCharacters=/[%\'"]/;if($scope.shopUrl)getRefDetails();marketingType?$sessionStorage.omniture_referrer_siteid=marketingType:$sessionStorage.omniture_referrer_siteid="";mrktnOtc?$sessionStorage.omniture_referrer_otc=mrktnOtc:$sessionStorage.omniture_referrer_otc="";$scope.refCode?
$sessionStorage.omniture_refCode=$scope.refCode:$sessionStorage.omniture_refCode="";$scope.shopUrl?$sessionStorage.shopUrl=true:$sessionStorage.shopUrl=false;function getRefDetails(){var findARepRequest={"findARepData":{"devKey":$cookies.widget_activity,"langCd":$cookies.langCd,"mrktCd":$cookies.mrktCd,"version":registrationWSConfigData.getFindARep_version,"refCode":$scope.refCode}};var getFindARep=$resource(registrationWSConfigData.getFindARep_ws,{},{"save":{method:"POST",showSpinner:true}});getFindARep.save(findARepRequest,
function(data){var resp=data.findARepDataResp;if(resp.success){$scope.refObj={"rep_name":resp.firstName+" "+resp.lastName,"addr_city_nm":resp.city,"addr_st_cd":resp.state,"prsnl_website_url_txt":$scope.refCode,"estore_mapg_ind":resp.estoreMapgInd,"acct_nr":resp.acctNr};$scope.showRefDiv=true;$scope.mentorActNo=resp.acctNr}})}$scope.togglePassword=function(){$(".toggle-password").attr("toggle");var pswd=document.getElementById("password");if(pswd.type==="password")pswd.type="text";else pswd.type="password"};
if(isEditMode){jQuery("#password-error-messages").show();jQuery("#duplicate-email-error-message").show();jQuery("#removeMentor").removeClass("modal").addClass("in").attr("style","display:block");jQuery("#welcomeBack").removeClass("modal").addClass("in").attr("style","display:block");jQuery("#regComplete").removeClass("modal").addClass("in").attr("style","display:block")}else{jQuery("#password-error-messages").hide();jQuery("#duplicate-email-error-message").hide();jQuery("#removeMentor").modal("hide");
jQuery("#welcomeBack").modal("hide");jQuery("#regComplete").modal("hide")}if($sessionStorage.regDetails!="null"&&$sessionStorage.regDetails!=null&&$sessionStorage.regDetails!=undefined){$scope.firstName=$sessionStorage.regDetails.frstNm;$scope.lastName=$sessionStorage.regDetails.lastNm;$scope.email=$sessionStorage.regDetails.emailAddrTxt}function validateEmail(val){if(!angular.isUndefined(val)){var filter=/^[_a-zA-Z0-9\-]+(\.[_a-zA-Z0-9\-]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})$/;if(filter.test(val))return true;
else return false}else return false}function validateName(val){if(!angular.isUndefined(val)){var filter=/^[a-zA-Z\s.-]*$/;if(filter.test(val))return true;else return false}else return false}$scope.checkForEnterKeyPress=function($event){$scope.showError=false;var pwd=$("#password").val();if($scope.password==""||$scope.password==undefined||$scope.password.trim()==""){$scope.strength="";$("#password-error-messages").hide();$("#pswdStrDiv").removeClass("pink");$("#pswdStrDiv").find("span").removeClass("lt-checkmark lt-medium").addClass("lt-close lt-medium");
$("#charDiv").removeClass("pink");$("#charDiv").find("span").removeClass("lt-checkmark lt-medium").addClass("lt-close lt-medium");$("#symbolDiv").removeClass("pink");$("#symbolDiv").find("span").removeClass("lt-checkmark lt-medium").addClass("lt-close lt-medium");$("#numberDiv").removeClass("pink");$("#numberDiv").find("span").removeClass("lt-checkmark lt-medium").addClass("lt-close lt-medium");$("#letterDiv").removeClass("pink");$("#letterDiv").find("span").removeClass("lt-checkmark lt-medium").addClass("lt-close lt-medium");
letterFlag=false;lengthFlag=false;symbolFlag=false;$scope.validatePasswordComplexity=false}else{$("#password-error-messages").show();$scope.strength=$scope.weakLabel;if(pwd.length>=6){$("#charDiv").addClass("pink");$("#charDiv").find("span").removeClass("lt-close lt-medium").addClass("lt-checkmark lt-medium");lengthFlag=true}else{$("#charDiv").removeClass("pink");$("#charDiv").find("span").removeClass("lt-checkmark lt-medium").addClass("lt-close lt-medium");lengthFlag=false}if(specialChar.test(pwd)){$("#symbolDiv").addClass("pink");
$("#symbolDiv").find("span").removeClass("lt-close lt-medium").addClass("lt-checkmark lt-medium");symbolFlag=true}else{$("#symbolDiv").removeClass("pink");$("#symbolDiv").find("span").removeClass("lt-checkmark lt-medium").addClass("lt-close lt-medium");symbolFlag=false}if(number.test(pwd)){$("#numberDiv").addClass("pink");$("#numberDiv").find("span").removeClass("lt-close lt-medium").addClass("lt-checkmark lt-medium");numberFlag=true}else{$("#numberDiv").removeClass("pink");$("#numberDiv").find("span").removeClass("lt-checkmark lt-medium").addClass("lt-close lt-medium");
numberFlag=false}if(letter.test(pwd)){$("#letterDiv").addClass("pink");$("#letterDiv").find("span").removeClass("lt-close lt-medium").addClass("lt-checkmark lt-medium");letterFlag=true}else{$("#letterDiv").removeClass("pink");$("#letterDiv").find("span").removeClass("lt-checkmark lt-medium").addClass("lt-close lt-medium");letterFlag=false}if(lengthFlag&&symbolFlag&&letterFlag&&numberFlag){$scope.strength=$scope.strongLabel;$("#pswdStrDiv").addClass("pink");$("#pswdStrDiv").find("span").removeClass("lt-close lt-medium").addClass("lt-checkmark lt-medium");
$("#charDiv").hide();$("#symbolDiv").hide();$("#numberDiv").hide();$("#letterDiv").hide();$scope.validatePasswordComplexity=true}else{$scope.strength=$scope.weakLabel;$("#pswdStrDiv").removeClass("pink");$("#pswdStrDiv").find("span").removeClass("lt-checkmark lt-medium").addClass("lt-close lt-medium");$("#charDiv").show();$("#symbolDiv").show();$("#numberDiv").show();$("#letterDiv").show();$scope.validatePasswordComplexity=false}}};function resetErrMsg(){$scope.firstNameRequired=false;$scope.firstNameInvalid=
false;$scope.lastNameRequired=false;$scope.lastNameInvalid=false;$scope.emailInvalid=false;$scope.emailRequired=false;$scope.passwordRequired=false;$scope.passwordInvalid=false}$scope.registerUser=function($event){$scope.trackingData=[];resetErrMsg();$scope.passwordRequired=$scope.password==undefined||$scope.password=="";if($scope.firstName==undefined||$scope.firstName.trim()==""){$scope.firstNameRequired=true;$scope.firstNameInvalid=false}else $scope.firstNameInvalid=!validateName($scope.firstName.trim());
if($scope.lastName==undefined||$scope.lastName.trim()==""){$scope.lastNameRequired=true;$scope.lastNameInvalid=false}else $scope.lastNameInvalid=!validateName($scope.lastName.trim());if($("#email").val()==undefined||$("#email").val().trim()==""){$scope.emailRequired=true;$scope.emailInvalid=false}else $scope.emailInvalid=!validateEmail($("#email").val().trim());var specialCharacters=/[%\'"]/;$scope.passwordInvalid=specialCharacters.test($scope.password);$scope.lastNameRequired||$scope.lastNameInvalid?
$scope.trackingData.push($scope.lastNameLabel):"";$scope.firstNameRequired||$scope.firstNameInvalid?$scope.trackingData.push($scope.firstNameLabel):"";$scope.passwordRequired||!$scope.validatePasswordComplexity?$scope.trackingData.push($scope.passwordLabel):"";$scope.emailRequired||$scope.emailInvalid?$scope.trackingData.push($scope.emailAddress):"";if($scope.registerForm.$valid&&!$scope.passwordRequired&&!$scope.firstNameRequired&&!$scope.lastNameRequired&&!$scope.emailRequired&&!$scope.firstNameInvalid&&
!$scope.lastNameInvalid&&!$scope.emailInvalid&&$scope.validatePasswordComplexity&&!$scope.passwordInvalid){$scope.showError=false;jQuery("#duplicate-email-error-message").hide();$("#email_div").removeClass("has-error");$("#email_div").find("span").removeClass("text-danger");var inputRegister=JSON.stringify({"registrationReq":{"langCd":$cookies.langCd,"devKey":$cookies.widget_activity,"firstName":$scope.firstName,"lastName":$scope.lastName,"emailAddrTxt":$scope.email,"password":$scope.password,"oprnTypInd":"EMAIL",
"mrktCd":$cookies.mrktCd,"mentrRefCd":$scope.refCode,"mrktChnType":mrktnChnlTyp,"mrktSrcType":mrktnSource,"mrktPrgType":marketingType,"mrktOtcType":mrktnOtc,"mentrAcctNo":$scope.mentorActNo,"siteId":$scope.siteid,"shopUrl":$scope.shopUrl,"deviceType":device,"version":registrationWSConfigData.register_version}});if($event){$scope.buttonObject=$($event.currentTarget);$scope.buttonObject.addClass("disabled")}var Job=$resource(registrationWSConfigData.register_ws);Job.save(inputRegister,function(data){var visitType=
"new";if(data.AGSFault){$scope.showError=true;$scope.error_message=errorContentDataJSON.generalErrorMessage;$scope.trackingData.push($scope.error_message);$("#continueBtn").triggerHandler("registrationErrorEvent",[$scope.trackingData]);$scope.trackingData=[];if($scope.buttonObject)$scope.buttonObject.removeClass("disabled")}else if(data.registrationResp.success==true){$sessionStorage.regDetails=data.registrationResp.regDetails;$sessionStorage.regDetails.custCare=$scope.isCustCare;if($scope.customerCareId!=
undefined&&$scope.customerCareId!=null)$sessionStorage.regDetails.customerCareId=$scope.customerCareId;$sessionStorage.emailId=data.registrationResp.emailAddrTxt;$sessionStorage.rgstrnId=data.registrationResp.dataFields.rgstrn_id;$sessionStorage.regDetails.newVisitor=true;if(data.registrationResp.errors!=undefined&&data.registrationResp.errors[0].errCd==="10971"){$sessionStorage.regDetails.newVisitor=false;if($sessionStorage.regDetails.asgndAcctNr!=undefined&&$sessionStorage.regDetails.asgndAcctNr!=
""){visitType="rep";jQuery("#regComplete").modal("show")}else{visitType="returning";jQuery("#welcomeBack").modal("show")}if($scope.buttonObject)$scope.buttonObject.removeClass("disabled")}else{$("#continueBtn").triggerHandler("registrationSuccessEvent");if($scope.shopUrl&&(expParam!=null&&expParam!=""))window.location=redirectCtxPath+pagesJSON.basicInfoPage+"?shopURL\x3d"+$scope.refCode+"\x26exp\x3d"+expParam;else if($scope.shopUrl)window.location=redirectCtxPath+pagesJSON.basicInfoPage+"?shopURL\x3d"+
$scope.refCode;else if(expParam!=null&&expParam!="")window.location=redirectCtxPath+pagesJSON.basicInfoPage+"?exp\x3d"+expParam;else window.location=redirectCtxPath+pagesJSON.basicInfoPage}}else if(data.registrationResp.success==false){if(data.registrationResp.errors[0].errCd==="10970"){visitType="rep";$scope.trackingData.push($scope.emailAddress);$("#continueBtn").triggerHandler("registrationErrorEvent",[$scope.trackingData]);$scope.trackingData=[];$("#email_div").addClass("has-error");$("#email_div").find("span").addClass("text-danger");
jQuery("#duplicate-email-error-message").show()}else{$scope.showError=true;$scope.error_message=errorContentDataJSON.generalErrorMessage;$scope.trackingData.push($scope.error_message);$("#continueBtn").triggerHandler("registrationErrorEvent",[$scope.trackingData]);$scope.trackingData=[]}if($scope.buttonObject)$scope.buttonObject.removeClass("disabled")}visitType?$sessionStorage.omniture_visit_type=visitType:$sessionStorage.omniture_visit_type=""})}else{$("#continueBtn").triggerHandler("registrationErrorEvent",
[$scope.trackingData]);$scope.trackingData=[]}};$scope.nextPage=function(){jQuery("#welcomeBack").modal("hide");jQuery("#regComplete").modal("hide");$("#continueBtn").triggerHandler("registrationSuccessEvent");if($scope.shopUrl&&(expParam!=null&&expParam!=""))window.location=redirectCtxPath+pagesJSON.basicInfoPage+"?shopURL\x3d"+$scope.refCode+"\x26exp\x3d"+expParam;else if($scope.shopUrl)window.location=redirectCtxPath+pagesJSON.basicInfoPage+"?shopURL\x3d"+$scope.refCode;else if(expParam!=null&&
expParam!="")window.location=redirectCtxPath+pagesJSON.basicInfoPage+"?exp\x3d"+expParam;else window.location=redirectCtxPath+pagesJSON.basicInfoPage};$scope.keepMentor=function(){jQuery("#removeMentor").modal("hide")};$scope.deleteMentor=function(){$scope.refCode="";$scope.showRefDiv=false;jQuery("#removeMentor").modal("hide")}}]).directive("registerPage",function(){return{restrict:"EAC",templateUrl:function(elem,attrs){return attrs.templateUrl}}}).directive("validateSplChar",function($rootScope){return{restrict:"A",
link:function($scope,element,attr,ctrl){$rootScope.placeHolderValue="";element.on("keypress",function(e){var value=String.fromCharCode(e.which);var targetName=e.target.name;if(e.which==8||e.which==0)return true;hasAllowedSplChar=/^[a-zA-Z~!@#$%^*()_+=.\-]*$/.test(value);if(hasAllowedSplChar)return true;else return false})}}}).directive("onErrorSrc",function(){return{link:function(scope,element,attrs){element.bind("error",function(){if(attrs.src!=attrs.onErrorSrc)attrs.$set("src",attrs.onErrorSrc)})}}});
app.filter("capitalize",function(){return function(input,scope){if(input!=null)input=input.toLowerCase();return input.substring(0,1).toUpperCase()+input.substring(1)}});